environment = "dev"

# Find your object ID with: az ad signed-in-user show --query id -o tsv
# At least one owner is required
#
# Naming convention (enforced):
#   Backends: {app_name}-Backend-{STAGE}  (e.g., Portal-Backend-DEV)
#   SPAs:     {app_name}-Frontend-{STAGE} (e.g., Portal-Frontend-DEV)

# Backend APIs
backends = {
  # Portal: Uses default roles, creates Azure AD groups for role assignments
  portal = {
    app_name           = "Portal"
    create_role_groups = true
    owners             = ["00000000-0000-0000-0000-000000000000", "11111111-1111-1111-1111-111111111111"]
    # app_roles not specified -> uses defaults (user, viewer, admin)
    # Optional: enable_claims_mapping = true  # Requires Azure AD Premium
  }

  # Billing: Custom roles, uses existing groups from identity team
  billing = {
    app_name = "Billing"
    owners   = ["00000000-0000-0000-0000-000000000000", "11111111-1111-1111-1111-111111111111"]
    app_roles = {
      reader = {
        display_name = "Reader"
        description  = "View invoices and billing history"
      }
      admin = {
        display_name = "Admin"
        description  = "Manage billing settings and payments"
      }
    }
    role_group_assignments = {
      reader = "22222222-2222-2222-2222-222222222222"
      admin  = "33333333-3333-3333-3333-333333333333"
    }
  }

  # Scheduler: Backend-to-backend access example (client credential flow)
  scheduler = {
    app_name = "Scheduler"
    owners   = ["00000000-0000-0000-0000-000000000000", "11111111-1111-1111-1111-111111111111"]
    # This backend can call the billing API with the specified roles
    target_backends = {
      billing = {
        roles = ["reader"]
      }
    }
  }
}

# SPAs - can have multiple SPAs per backend
spas = {
  # Two SPAs sharing the Portal backend
  portal-web = {
    app_name      = "Portal"
    backend       = "portal"
    redirect_uris = ["https://portal.example.com", "http://localhost:3000"]
    owners        = ["00000000-0000-0000-0000-000000000000", "11111111-1111-1111-1111-111111111111"]
  }
  portal-admin = {
    app_name      = "PortalAdmin"
    backend       = "portal"
    redirect_uris = ["https://admin.portal.example.com"]
    owners        = ["00000000-0000-0000-0000-000000000000", "11111111-1111-1111-1111-111111111111"]
  }

  # Single SPA for Billing
  billing-web = {
    app_name      = "Billing"
    backend       = "billing"
    redirect_uris = ["https://billing.example.com"]
    owners        = ["00000000-0000-0000-0000-000000000000", "11111111-1111-1111-1111-111111111111"]
  }
}
